# åŸºç¡€è·¯ç”±åŠå¯åŠ¨

```python
from flask import Flask  # flaskçš„æ ¸å¿ƒç±»

# åˆå§‹åŒ–webåº”ç”¨ç¨‹åºçš„ç¤ºä¾‹å¯¹è±¡,å…¥å£é»˜è®¤ä½¿ç”¨__name__ä½œä¸ºä¸»è¦å…¥å£
app = Flask(__name__)


# é€šè¿‡å®ä¾‹åŒ–å¯¹è±¡æä¾›çš„routeè·¯ç”±è£…é¥°å™¨ç»‘å®šè§†å›¾ä¸urlåœ°å€çš„å…³ç³»,å‡½æ•°å³è§†å›¾
@app.route("/")
def index():
    # é»˜è®¤flaskæ”¯æŒå‡½æ•°è§†å›¾ï¼Œè§†å›¾åç§°ä¸èƒ½é‡å¤
    # è§†å›¾çš„è¿”å›å€¼å°†è¢«flaskåŒ…è£…æˆå“åº”å¯¹è±¡çš„HTMLæ–‡æ¡£å†…å®¹ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯
    return "hello flask"


if __name__ == '__main__':
    """
    å¯åŠ¨å®ä¾‹åŒ–å¯¹è±¡,å³flaskå…¨æ ˆ
    host: å…è®¸è¢«è®¿é—®çš„ipï¼Œ0.0.0.0è¡¨ç¤ºä»»æ„ä¸»æœº
    port: å…¨æ ˆçš„è¿è¡Œç«¯å£ï¼Œé»˜è®¤5000
    """
    app.run(host='0.0.0.0', port=5000)
```

# é¡¹ç›®åŠ è½½é…ç½®

## æ–¹å¼ä¸€

ç›´æ¥åœ¨å®ä¾‹åŒ–å¯¹è±¡ä¸‹é¢å®šä¹‰

```python
from flask import Flask

app = Flask(__name__)

# æƒ³æ›´æ”¹å¤šä¸ª
config = {
    'DEBUG': True
}
app.config.update(config)

# åªæƒ³æ”¹ä¸€ä¸ª
# app.config['DEBUG'] = True
```

## æ–¹å¼äºŒ

æ¥è‡ªpythonæ–‡ä»¶çš„ç±»å¯¹è±¡

```python
"""é…ç½®ï¼Œç±»å¯¹è±¡"""


class Settings(object):
    DEBUG = True
```

```python
"""flaskå®ä¾‹"""
from flask import Flask
from settings import Setting

app = Flask(__name__)

# æ¥è‡ªç±»å¯¹è±¡çš„è®¾ç½®
app.config.from_object(Setting)
```

## æ–¹å¼ä¸‰

æ¥è‡ªpythonæ–‡ä»¶çš„å˜é‡å’Œå€¼

```python
"""é…ç½®ï¼Œpythonæ–‡ä»¶"""
DEBUG = True
```

```python
"""flaskå®ä¾‹"""
from flask import Flask

app = Flask(__name__)

# æ¥è‡ªpythonæ–‡ä»¶çš„é…ç½®
app.config.from_pyfile('setting.py')
```

# è·¯ç”±é…ç½®

## è·¯ç”±åœ°å€å’Œè¯·æ±‚æ–¹æ³•

```python
from flask import Flask

app = Flask(__name__)
app.config['DEBUG'] = True

"""
è£…é¥°å™¨çš„å‚æ•°ï¼š
    rule: å½“å‰è§†å›¾åœ°å€,/è¡¨ç¤ºæ ¹ç›®å½•
    methods: å½“å‰è§†å›¾å…è®¸çš„è¯·æ±‚æ–¹æ³•ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œä¸å†™é»˜è®¤æ˜¯GET
"""


@app.route(rule="/", methods=['GET', 'POST'])
def index():
    return "hello flask"


if __name__ == '__main__':
    app.run()
```

## è·¯ç”±å‚æ•°æ¥æ”¶

- æ”¯æŒçš„ç±»å‹æœ‰
    - stringï¼ˆé»˜è®¤ï¼‰ï¼šä¸åŒ…å« / çš„ä»»æ„å­—ç¬¦ä¸²ã€‚
    - intï¼šæ­£æ•´æ•°ã€‚
    - floatï¼šæµ®ç‚¹æ•°ã€‚
    - pathï¼šç±»ä¼¼ stringï¼Œä½†å¯ä»¥åŒ…å« /ã€‚
    - uuidï¼šUUID å¯¹è±¡ã€‚

```python
from flask import Flask

app = Flask(__name__)
app.config['DEBUG'] = True

"""
åœ¨ruleè·¯ç”±åœ°å€ä¸­å¯ä»¥å†™æƒ³è¦æ¥æ”¶çš„å˜é‡ï¼Œå¦‚æœæ²¡ç”¨é™åˆ¶æ•°æ®ç±»å‹é»˜è®¤è¿”å›å­—ç¬¦ä¸²:/<data>
é™åˆ¶æ•°æ®ç±»å‹è¯·æ±‚ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨é‡Œé¢åŠ ä¸€ä¸ªæ•°æ®ç±»å‹å³å¯ï¼š/<int:number>
"""


@app.route(rule="/<data>/<int:number>", methods=['GET', 'POST'])
def index(data, number):
    print(data, number)
    return "hello flask"


if __name__ == '__main__':
    app.run()
```

## è‡ªå®šä¹‰è·¯ç”±å‚æ•°è½¬æ¢

åœ¨å¼€å‘ä¸­è·¯ç”±å‚æ•°æ¥æ”¶æ”¯æŒçš„ç±»å‹ä¸­ï¼Œè™½ç„¶å¯ä»¥æ¥æ”¶å­—ç¬¦ä¸²ï¼Œä½†å¯èƒ½ä¼šä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°æ­£åˆ™åŒ¹é…ï¼Œæ ¹æ®è‡ªå·±çš„è§„åˆ™å»é™å®šè¯·æ±‚å‚æ•°å†è¿›è¡Œè®¿é—®

```python
"""ç±»å‹è½¬æ¢å™¨ï¼Œä¸€èˆ¬éƒ½æ”¾äºå•ç‹¬æ–‡ä»¶ä¸­"""

# å¯¼å…¥åŸºç±»
from werkzeug.routing.converters import BaseConverter


# å®šä¹‰è·¯ç”±å‚æ•°è½¬æ¢å™¨ç±»
class SmsConverter(BaseConverter):
    # è¿™å†™ä½ è¦åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼å³å¯
    regex = r'1[3-9]\d{9}'
```

```python
"""flaskå…¨æ ˆï¼Œæ³¨å†Œå’Œä½¿ç”¨"""

from flask import Flask
from converters import SmsConverter  # å¯¼å…¥å†™å¥½çš„è½¬æ¢å™¨

app = Flask(__name__)
app.config['DEBUG'] = True

# æ³¨å†Œåˆ°flaskå®ä¾‹å¯¹è±¡
app.url_map.converters['sms'] = SmsConverter


# ä½¿ç”¨å’Œå¸¸è§„çš„ä¸€æ ·
@app.route(rule="/<sms:number>", methods=['GET', 'POST'])
def index(number):
    print(type(number))  # str
    print(number)
    return "hello flask"
```

# requestæ•°æ®è¯·æ±‚åŠå“åº”

## è¯·æ±‚

è·å–å®¢æˆ·ç«¯è¯·æ±‚æºå¸¦çš„ä¿¡æ¯éœ€è¦å¯¼å…¥requestæ–¹æ³•æ¥è·å–ï¼Œç›´æ¥åœ¨è§†å›¾ä¸‹é¢æ“ä½œå³å¯

```python
"""
å¯¼å…¥requestæ–¹æ³•å¯ä»¥è·å–åˆ°å®¢æˆ·ç«¯æºå¸¦çš„è¯·æ±‚ä¿¡æ¯
"""
from flask import Flask, request

app = Flask(__name__)


@app.route("/index")
def index():
    """è·å–è¯·æ±‚ä¿¡æ¯æ–¹æ³•"""
    print(request)  # é‡Œé¢æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥ä½¿ç”¨

    return "success"


if __name__ == '__main__':
    app.run(host="0.0.0.0")
```

### è·å–è¯·æ±‚æ–¹æ³•

```python
from flask import request

"""è·å–æœ¬æ¬¡è¯·æ±‚çš„æ–¹æ³•"""
print(request.method)
```

### è·å–è¯·æ±‚url

```python
from flask import request

"""è·å–æœ¬æ¬¡è¯·æ±‚url"""
print(request.url)  # å®Œæ•´url
print(request.path)  # è·¯ç”±çš„è·¯å¾„
```

### è·å–è¯·æ±‚å¤´ä¿¡æ¯

```python
from flask import request

print(request.headers)  # å¯ä»¥å½“æˆå­—å…¸å–å€¼
```

### è·å–ç”¨æˆ·å®¢æˆ·ç«¯ç¯å¢ƒä¿¡æ¯

```python
from flask import request

print(request.user_agent)  # è¯·æ±‚è®¾å¤‡æ ‡å¿—UA
print(request.remote_addr)  # å®¢æˆ·ç«¯è¿œç¨‹åœ°å€
print(request.server)  # æœåŠ¡ç«¯çš„ç«¯ç‚¹ï¼Œæ ¼å¼ï¼š(IP, ç«¯å£)
```

### è·å–æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°

åªé€‚ç”¨äº GET è¯·æ±‚ ä¸­çš„ URL æŸ¥è¯¢å‚æ•°

ä¸¾ä¾‹ï¼šhttps://www.baidu.com?key=flask --> é—®å¥½åé¢çš„é”®å€¼å¯¹

```python
from flask import request

print(request.args.get("key"))  # è·å–å‚æ•°å€¼ï¼Œé»˜è®¤è¿”å›å­—ç¬¦ä¸²
print(request.args.getlist("key"))  # è·å–åŒåå‚æ•°åˆ—è¡¨ï¼Œå¦‚ ?a=1&a=2
```

### è·å–è¯·æ±‚ä½“

```python
from flask import request

"""è·å–è¯·æ±‚ä½“,å¦‚æœå®¢æˆ·ç«¯ä¸Šä¼ çš„æ˜¯xmlæ–‡æ¡£ï¼Œhtmlæ ¼å¼ï¼ŒäºŒè¿›åˆ¶æµæ ¼å¼ï¼Œbase64æ ¼å¼ï¼Œå°±è¦ç”¨dataæ¥æ”¶"""
print(request.data)
print(type(request.data))  # bytes
```

### è·å–formè¡¨å•æ•°æ®

```python
from flask import request

"""æ¥å—è¡¨å•ä¸Šä¼ æ•°æ®"""
print(request.form)  # å¯ä»¥å­—å…¸å–å€¼
```

### è·å–jsonæ•°æ®

```python
from flask import request

"""æ¥æ”¶jsonæ•°æ®"""
print(request.json)  # å¯ä»¥å­—å…¸å–å€¼
print(request.is_json)  # åˆ¤æ–­æ˜¯å¦jsonæ•°æ®
```

### è·å–æ–‡ä»¶æ•°æ®

```python
from flask import request

"""æ¥æ”¶æ–‡ä»¶æ•°æ®"""
file = request.files['file']  # è·å–æ–‡ä»¶å†…å®¹ï¼Œå­—æ®µæ˜¯fileçš„
filename = file.filename  # è·å–æ–‡ä»¶åç§°
file.save(filename)  # ä½¿ç”¨æ–‡ä»¶åä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°
```

## å“åº”

é»˜è®¤è¿”å›çš„æ˜¯HTMLå­—ç¬¦ä¸²ä»£ç 

### è¿”å›jsonæ•°æ®

```python
"""
å¯¼å…¥jsonifyæ–¹æ³•å¯ä»¥å¤„ç†è¿”å›jsonæ•°æ®ç»™å®¢æˆ·ç«¯
"""
from flask import Flask, jsonify

app = Flask(__name__)


@app.route("/index/", methods=['GET', 'POST'])
def index():
    json_data = {
        'name': 'å°æ˜',
        "age": 19
    }

    # return json_data  # è™½ç„¶å¯ä»¥ç›´æ¥è¿”å›jsonæ•°æ®ï¼Œä½†ä½¿ç”¨ jsonify() æ›´å®‰å…¨ã€è§„èŒƒã€å…¼å®¹
    return jsonify(json_data)


if __name__ == '__main__':
    app.run(host="0.0.0.0")
```

### è‡ªå®šä¹‰çŠ¶æ€ç å’Œå“åº”å¤´

- å¸¸ç”¨å†™æ³•ï¼šreturn å“åº”ä½“, çŠ¶æ€ç , å“åº”å¤´
    - ä¸€èˆ¬è¿”å›æ•°æ®ä¼šå†™ä¸€ä¸ªçŠ¶æ€ç ï¼Œé»˜è®¤200å¯ä»¥ä¸å†™
    - ä½¿ç”¨æ–¹æ³•è¿”å›çš„å“åº”é€šå¸¸ä¸éœ€è¦é¢å¤–æ“ä½œï¼Œä¾‹å¦‚ï¼šjsonify é»˜è®¤å°±ä¼šè®¾ç½® Content-Type: application/jsonï¼Œæ‰€ä»¥é€šå¸¸ä¸ç”¨æ‰‹åŠ¨å†åŠ è¿™ä¸ªå¤´ï¼Œé™¤éä½ è¦è‡ªå®šä¹‰å…¶ä»– headerã€‚

```python
from flask import Flask, make_response, Response

app = Flask(__name__)


@app.route("/")
def index():
    """å¸¸ç”¨ä»¥ä¸‹å†™æ³•"""
    # return 'ok', 201, {"Company": "python-310"}

    """æ‹†åˆ†åŸç†"""
    # response = make_response('ok', 201, {"Company": "python-310"})
    # return response

    """å†æ‹†åˆ†åŸç†"""
    # response = Response("ok")
    # response.headers["Company"] = "oldboy" # è‡ªå®šä¹‰å“åº”å¤´
    # response.status_code = 201             # è‡ªå®šä¹‰å“åº”çŠ¶æ€ç 
    # return response


if __name__ == '__main__':
    app.run()
```

# redirecté‡å®šå‘

```python
"""
å¯¼å…¥redirectæ–¹æ³•å¯ä»¥å¤„ç†é‡å®šå‘æ“ä½œ
"""
from flask import Flask, redirect

app = Flask(__name__)


@app.route('/page')
def page():
    return "ok"


@app.route("/")
def index():
    """
    301: æ°¸ä¹…é‡å®šå‘ï¼Œé¡µé¢å·²ç»æ²¡æœ‰äº†ï¼Œç«™ç‚¹æ²¡æœ‰äº†ï¼Œæ°¸ä¹…è½¬ç§»äº†ã€‚
    302: ä¸´æ—¶é‡å®šå‘ï¼Œä¸€èˆ¬éªŒè¯å¤±è´¥ã€è®¿é—®éœ€è¦æƒé™çš„é¡µé¢è¿›è¡Œç™»å½•è·³è½¬æ—¶ï¼Œéƒ½æ˜¯å±äºä¸´æ—¶è·³è½¬ã€‚
    """

    # å¤–éƒ¨é¡µé¢é‡å®šå‘
    # response = redirect("https://www.qq.com", 302)

    # å†…éƒ¨é‡å®šå‘(è§†å›¾é‡å®šå‘)
    response = redirect("/page", 302)

    return response


if __name__ == '__main__':
    app.run()
```

# cookieä¼šè¯æ§åˆ¶(ä¸å¸¸ç”¨äº†)

Cookieæ˜¯ç”±æœåŠ¡å™¨ç«¯ç”Ÿæˆï¼Œå‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¼šå°†Cookieçš„key/valueä¿å­˜ï¼Œä¸‹æ¬¡è¯·æ±‚åŒä¸€ç½‘ç«™æ—¶å°±éšç€è¯·æ±‚å¤´è‡ªåŠ¨å‘é€è¯¥Cookieç»™æœåŠ¡å™¨ï¼ˆå‰ææ˜¯æµè§ˆå™¨è®¾ç½®ä¸ºå¯ç”¨cookieï¼‰ã€‚Cookieçš„key/valueå¯ä»¥ç”±æœåŠ¡å™¨ç«¯è‡ªå·±å®šä¹‰ã€‚

Cookieæ˜¯å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­çš„ä¸€æ®µ**çº¯æ–‡æœ¬ä¿¡æ¯**ï¼Œå»ºè®®ä¸è¦å­˜å‚¨æ•æ„Ÿä¿¡æ¯å¦‚å¯†ç ï¼Œå› ä¸ºç”µè„‘ä¸Šçš„æµè§ˆå™¨å¯èƒ½è¢«å…¶å®ƒäººä½¿ç”¨

CookieåŸºäºåŸŸåå®‰å…¨ï¼Œä¸åŒåŸŸåçš„Cookieæ˜¯ä¸èƒ½äº’ç›¸è®¿é—®çš„

**åœ¨`æ•°æ®è¯·æ±‚åŠå“åº”/å“åº”/è‡ªå®šä¹‰çŠ¶æ€ç å’Œå“åº”å¤´`ä¸­æåˆ°make_responseå¯ä»¥åˆ¶ä½œä¸€ä¸ªå“åº”å¯¹è±¡,éœ€è¦ä½¿ç”¨é‡Œé¢çš„æ–¹æ³•æ¥æ“ä½œcookieï¼Œä¸‹é¢ä»£ç éƒ½æ˜¯åœ¨è§†å›¾ä¸‹é¢æ“ä½œçš„**

## è®¾ç½®cookie

ä¸èƒ½ç›´æ¥å­˜å‚¨ä¸­æ–‡ï¼Œå¦‚æœéœ€è¦è¦è¿›è¡Œè½¬ç ç­‰è¡Œä¸º

```python
from flask import make_response
from datetime import datetime, timedelta

"""è®¾ç½®cookieï¼Œé€šè¿‡responseä¼ é€’åˆ°å®¢æˆ·ç«¯è¿›è¡Œä¿å­˜"""
response = make_response('å†…å®¹')
response.set_cookie('user', 'BinaryFool')  # é»˜è®¤æ˜¯sessionä¼šè¯ï¼Œå…³é—­æµè§ˆå™¨åå½“å‰cookieå°±ä¼šè¢«åˆ é™¤
response.set_cookie('age', '19', max_age=30)  # max_ageæ˜¯æŒ‡å®šæœ€å¤§æœ‰æ•ˆæ—¶é—´ï¼Œè¿‡æœŸä»¥åæµè§ˆå™¨åˆ é™¤cookieï¼Œå•ä½æ˜¯ç§’
response.set_cookie('token', 'abc', expires=datetime.utcnow() + timedelta(hours=1))  # åˆ°å…·ä½“æ—¶é—´ç‚¹è¿‡æœŸï¼Œä»¥ä¸ºæµè§ˆå™¨å­˜å‚¨çš„æ˜¯utcæ—¶é—´ï¼Œè¿™é‡Œä¹Ÿéœ€è¦ä½¿ç”¨utcæ—¶é—´
# return response  # è¿”å›åˆ°å®¢æˆ·ç«¯å³å¯
```

## è·å–cookie

```python
from flask import request

# è·å–å‰ç«¯è¯·æ±‚çš„cookie
print(request.cookies)  # å¯ä»¥ä½¿ç”¨å­—å…¸å–å€¼, æ²¡æœ‰å€¼åˆ™è¿”å›None
```

## åˆ é™¤cookie

åˆ é™¤cookieï¼Œé‡æ–°è®¾ç½®cookieçš„æ—¶é—´ï¼Œè®©æµè§ˆå™¨è‡ªå·±æ ¹æ®æœ‰æ•ˆæœŸæ¥åˆ é™¤

```python
from flask import make_response

response = make_response('åˆ é™¤cookie')

"""åˆ é™¤æ“ä½œè‚¯å®šæ˜¯åœ¨æµè§ˆå™¨å®Œæˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç½®ä¸‹cookieåç§°çš„å¯¹åº”æœ‰æ•ˆæ—¶é—´ä¸º0å³å¯ã€‚"""
# è®¾ç½® max_age=0 ä¼šè®©æµè§ˆå™¨ç«‹åˆ»åˆ é™¤ Cookieï¼Œè€Œæ­¤æ—¶å³ä½¿ expires è¢«è®¾ç½®æˆæœªæ¥çš„æ—¶é—´ï¼Œä¹Ÿä¼šè¢«å¿½ç•¥ï¼Œä»¥ max_age ä¸ºå‡†ï¼Œè®¾ç½®æ¸…é™¤åªéœ€è¦è®¾ç½®ä¸€ä¸ªå³å¯ï¼Œä¸éœ€è¦ä¸¤ä¸ªéƒ½å†™
response.set_cookie('username', '', max_age=0)
response.delete_cookie('username')  # å’Œä¸Šé¢çš„ç­‰æ•ˆï¼Œåªä¸è¿‡åº•å±‚å®ç°æ–¹æ³•æœ‰ç•¥å¾®åŒºåˆ«ï¼Œæ¨èä½¿ç”¨è¿™ä¸ª

# return response  # è¿”å›åˆ°å®¢æˆ·ç«¯å³å¯
```

# Sessionä¼šè¯æ§åˆ¶

å¯¹äºæ•æ„Ÿã€é‡è¦çš„ä¿¡æ¯ï¼Œå»ºè®®è¦å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œä¸èƒ½å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œå¦‚æ‰‹æœºå·ã€éªŒè¯ç ç­‰ä¿¡æ¯

åœ¨æœåŠ¡å™¨ç«¯è¿›è¡ŒçŠ¶æ€ä¿æŒçš„æ–¹æ¡ˆå°±æ˜¯`Session`

**Sessionä¾èµ–äºCookie**,sessionçš„IDä¸€èˆ¬é»˜è®¤é€šè¿‡cookieæ¥ä¿å­˜åˆ°å®¢æˆ·ç«¯ã€‚åå­—ä¸€èˆ¬å«ï¼šsessionid

flaskä¸­çš„sessionéœ€è¦åŠ å¯†,æ‰€ä»¥ä½¿ç”¨sessionä¹‹å‰å¿…é¡»é…ç½®SECRET_KEYé€‰é¡¹,å¦åˆ™æŠ¥é”™.

æ³¨æ„ï¼šä¸€èˆ¬æ¡†æ¶éƒ½æ˜¯æŠŠsessionæ•°æ®ä¿å­˜åˆ°æœåŠ¡ç«¯ï¼Œä½†æ˜¯ï¼Œflaské‡Œé¢çš„sessionæ˜¯åŸºäºtokenæ–¹å¼å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ï¼Œå¹¶æ²¡æœ‰æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼ä¿å­˜åœ¨æœåŠ¡ç«¯çš„æ–‡ä»¶ä¸­ã€‚ä¿å­˜çš„sessionæ˜¯åŠ å¯†çš„ï¼Œæ— æ³•çœ‹è§ï¼Œåªèƒ½é€šè¿‡flaskè®¾å®šçš„å¯†é’¥å»è§£å¯†

sessionæ“ä½œéƒ½æ˜¯åŸºäºè·¯ç”±è§†å›¾ä¸‹é¢çš„

## é…ç½®sessionè®¾ç½®

```python
from flask import Flask, session
from datetime import timedelta

app = Flask(__name__)

# è®¾ç½®å¯†é’¥
app.config['SECRET_KEY'] = 'abcdfgsssss'  # æ ¹æ®è‡ªå·±çš„éœ€æ±‚å¡«å†™ï¼Œæ²¡ç”¨å›ºå®šçš„ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨ä¸­æ–‡

# è®¾ç½®sessionçš„è¿‡æœŸæ—¶é—´
app.config['PERMANENT_SESSION_LIFETIME'] = timedelta(days=7)  # æ§åˆ¶æŒä¹…åŒ– session çš„å…·ä½“æ—¶é•¿ï¼ˆé»˜è®¤ 31 å¤©ï¼‰


@app.route('/')
def index():
    """
    session.permanent = True æŒä¹…åŒ– ä¸èƒ½å†™åœ¨å…¨å±€ï¼Œä¸ç„¶æ— æ•ˆï¼Œsession æ˜¯ è¯·æ±‚ä¸Šä¸‹æ–‡ï¼ˆrequest contextï¼‰ ç»‘å®šçš„ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šé‡æ–°åˆå§‹åŒ–ã€‚
    
    å¦‚æœä¸è®¾ç½®session.permanent = True  # å¯ç”¨æŒä¹…åŒ–
    åªåœ¨å½“å‰æµè§ˆå™¨ä¼šè¯ä¸­æœ‰æ•ˆ
    å…³é—­æµè§ˆå™¨å°±ä¼šå¤±æ•ˆï¼ˆæµè§ˆå™¨è‡ªåŠ¨æ¸…é™¤ï¼‰
    PERMANENT_SESSION_LIFETIME è®¾ç½® ä¸ä¼šç”Ÿæ•ˆ
    """
    session.permanent = True  # å¯ç”¨æŒä¹…åŒ–
    session['user'] = 'BinaryFool'
    return 'Logged in'
```

## è®¾ç½®session

```python
from flask import session

"""è®¾ç½®session"""

# å•ä¸ªé”®å€¼å¯¹
session['username'] = 'BinaryFool'
session['age'] = 19

# å•ä¸ªé”®å¤šä¸ªé”®å€¼å¯¹
session['info'] = {
    'username': 'BinaryFool',
    'age': '19'
}

# return 'ok' # ä¸éœ€è¦è¿”å›sessionï¼Œä¼šè‡ªåŠ¨å¤„ç†
```

## è·å–session

è¯·æ±‚å‚æ•°ç­‰ä¸éœ€è¦ä¼ å…¥sessionï¼Œä¼šè‡ªåŠ¨æ“ä½œä»–ä»¬ï¼Œç›´æ¥ä½¿ç”¨å³å¯

```python
from flask import session

"""è·å–session"""
print(session)  # è·å–sessionå¯¹è±¡
print(session.get('info'))  # è·å–å…·ä½“å€¼
# return 'ok'  # ä¸éœ€è¦è¿”å›sessionï¼Œä¼šè‡ªåŠ¨å¤„ç†
```

## åˆ é™¤session

```python
from flask import session

session.pop("username")  # åˆ é™¤æŒ‡å®šçš„keyå€¼
session.clear()  # æ¸…é™¤æ‰€æœ‰ session é¡¹ï¼Œä¸éœ€è¦è¿”å›ç»™å‰ç«¯ï¼Œä¼šè‡ªåŠ¨å¤„ç†
```

# è¯·æ±‚å…¨å±€é’©å­

- flask çš„â€œé’©å­ï¼ˆHookï¼‰â€æ˜¯ä¸€ç§ åœ¨è¯·æ±‚å¤„ç†è¿‡ç¨‹çš„ä¸åŒé˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ çš„æœºåˆ¶ï¼Œä¸»è¦ç”¨äºåšä¸€äº›å…¨å±€æ€§çš„å¤„ç†ï¼Œæ¯”å¦‚ï¼š
    - è¯·æ±‚å‰åšæƒé™æ£€æŸ¥æˆ–å‚æ•°æ ¡éªŒ
    - è¯·æ±‚åç»Ÿä¸€æ ¼å¼åŒ–å“åº”
    - è®°å½•æ—¥å¿—ã€ç»Ÿè®¡è€—æ—¶
    - æ‰“å¼€å’Œå…³é—­æ•°æ®åº“è¿æ¥ç­‰
- Flask ä¸­å¸¸ç”¨çš„é’©å­æœ‰ä¸‰ç§(æœ¬æ¥æœ‰å››ç§ï¼Œä½†æ˜¯ç»“åˆå¼€å‘ä¹ æƒ¯ç­‰å› ç´ åˆ é™¤äº†before_first_request)ï¼š
    - @app.before_requestï¼šåœ¨æ¯ä¸€ä¸ªè¯·æ±‚ä¹‹å‰è‡ªåŠ¨è°ƒç”¨ï¼ˆè§†å›¾å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼‰
    - @app.after_requestï¼šåœ¨æ¯ä¸€ä¸ªè¯·æ±‚ä¹‹åè‡ªåŠ¨è°ƒç”¨ï¼ˆè§†å›¾å‡½æ•°æ‰§è¡Œä¹‹åï¼Œå“åº”è¿”å›ä¹‹å‰ï¼‰
    - @app.teardown_requestï¼šè¯·æ±‚å¤„ç†å®Œåè‡ªåŠ¨è°ƒç”¨ï¼ˆæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼‰
- å¯ä»¥æŠŠ Flask çš„é’©å­ï¼ˆHookï¼‰ç†è§£ä¸ºä¸€ç§â€œè½»é‡çº§çš„ä¸­é—´ä»¶æœºåˆ¶â€ï¼Œä¸è¿‡å®ƒå’ŒçœŸæ­£çš„â€œä¸­é—´ä»¶â€è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«çš„
- Flask çš„é’©å­æ˜¯å®ç°ä¸­é—´ä»¶åŠŸèƒ½çš„æ–¹å¼ä¹‹ä¸€ï¼Œä½†ä¸å¦‚ä¼ ç»Ÿä¸­é—´ä»¶æœºåˆ¶çµæ´»å’Œé€šç”¨ã€‚

## before_request

æ¯æ¬¡å®¢æˆ·ç«¯è®¿é—®ï¼Œè§†å›¾æ‰§è¡Œä¹‹å‰ï¼Œéƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œè¢« @app.before_request æ‰€è£…é¥°çš„å‡½æ•°

å¸¸ç”¨äºæ¯æ¬¡è§†å›¾è®¿é—®ä¹‹å‰çš„å…¬å…±é€»è¾‘ä»£ç çš„è¿è¡Œ\[èº«ä»½è®¤è¯ï¼Œæƒé™åˆ¤æ–­ï¼Œè¯·æ±‚æ—¥å¿—]

åœ¨æ¯ä¸€ä¸ªè¯·æ±‚ä¹‹å‰è‡ªåŠ¨è°ƒç”¨ï¼ˆè§†å›¾å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼‰

### æ–¹æ¡ˆä¸€(æ¨è)

ç›´æ¥ä½¿ç”¨è£…é¥°å™¨æ³¨å†Œ

```python
"""
æ¯ä¸ªè¯·æ±‚å‰éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªæ³¨å†Œçš„é’©å­ä»£ç 
"""

from flask import Flask, request

app = Flask(__name__)


@app.before_request  # ç›´æ¥ä½¿ç”¨è£…é¥°å™¨æ³¨å†Œ
def before_request_event():
    if request.path.startswith('/static/'):  # å¦‚æœæ˜¯ä½ çš„é™æ€æ–‡ä»¶è®¿é—®å°±ä¸ç»§ç»­æ‰§è¡Œä¸‹é¢ä»£ç äº†
        return

    print("æ¯ä¸ªè¯·æ±‚å‰éƒ½æ‰§è¡Œäº†æ”¹ä»£ç ")


@app.route('/')
def index():
    print("index")
    return "index"


@app.route('/page')
def page():
    print("page")
    return "page"


if __name__ == '__main__':
    app.run()
```

### æ–¹æ¡ˆäºŒ

ä½¿ç”¨appå®ä¾‹åŒ–å¯¹è±¡æ³¨å†Œ

```python
"""
æ¯ä¸ªè¯·æ±‚å‰éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªæ³¨å†Œçš„é’©å­ä»£ç 
"""

from flask import Flask, request

app = Flask(__name__)


def before_request_event():
    if request.path.startswith('/static/'):  # å¦‚æœæ˜¯ä½ çš„é™æ€æ–‡ä»¶è®¿é—®å°±ä¸ç»§ç»­æ‰§è¡Œä¸‹é¢ä»£ç äº†
        return

    print("æ¯ä¸ªè¯·æ±‚å‰éƒ½æ‰§è¡Œäº†æ”¹ä»£ç ")


"""æ³¨å†Œå‰ç½®é’©å­"""
app.before_request(before_request_event)  # ä½¿ç”¨appå®ä¾‹åŒ–å¯¹è±¡æ³¨å†Œ


@app.route('/')
def index():
    print("index")
    return "index"


@app.route('/page')
def page():
    print("page")
    return "page"


if __name__ == '__main__':
    app.run()
```

## after_request

åœ¨æ¯ä¸€ä¸ªè¯·æ±‚ä¹‹åè‡ªåŠ¨è°ƒç”¨ï¼ˆè§†å›¾å‡½æ•°æ‰§è¡Œä¹‹åï¼Œå“åº”è¿”å›ä¹‹å‰ï¼‰ï¼Œå¸¸ç”¨äºè§†å›¾è®¿é—®ä¹‹åçš„å…¬å‘Šé€»è¾‘ä»£ç \[ç»“æœåŠ å·¥ï¼Œæ ¼å¼è½¬æ¢ï¼Œæ—¥å¿—è®°å½•]

åœ¨ä¸Šé¢çš„`before_request`å†™äº†ä¸¤ç§æ–¹æ¡ˆï¼Œafter_requesté’©å­ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ç¤ºä¾‹ä»£ç åªå±•ç¤ºä¸€ç§æ¨èçš„

```python
"""
æ¯ä¸ªè¯·æ±‚åå“åº”å‰éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªæ³¨å†Œçš„é’©å­ä»£ç 
"""

from flask import Flask, request

app = Flask(__name__)


# æ³¨å†Œé’©å­
@app.after_request
def after_request_event(response):  # éœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•°
    """å¦‚æœbefore_requesté’©å­returnäº†å°±ä¸ä¼šæ‰§è¡Œè¿™æ®µä»£ç äº†ï¼Œå¯ä»¥ä¸éœ€è¦å†™å¿½ç•¥é™æ€æ–‡ä»¶"""
    # if request.path.startswith('/static/'):
    # return

    """è·å–åˆ°çš„æ•°æ®éƒ½å¯ä»¥å†ä¸€æ¬¡å¤„ç†ï¼Œæ·»åŠ å“åº”å¤´ç­‰è¡Œä¸º"""
    print(response.status_code)  # è·å–å“åº”çŠ¶æ€ç 
    print(response.headers)  # è·å–å“åº”å¤´
    print(response.get_data(as_text=True))  # è·å–å“åº”æ­£æ–‡,as_text=Trueæ˜¯ä»¥æ–‡æœ¬å½¢å¼å±•ç¤º
    print("æ¯ä¸ªè¯·æ±‚åå“åº”å‰éƒ½æ‰§è¡Œäº†æ”¹ä»£ç ")

    return response  # éœ€è¦è¿”å›å“åº”ç»™ä¸‹ä¸€ä¸ªæ¨¡å—å¤„ç†


@app.route('/')
def index():
    print("index")
    return "index"


@app.route('/page')
def page():
    print("page")
    return "page"


if __name__ == '__main__':
    app.run()
```

## teardown_request

è®ºè¯·æ±‚æ˜¯å¦æˆåŠŸã€æ˜¯å¦æŠ›å¼‚å¸¸ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚ç»“æŸåæ‰§è¡Œï¼Œå¸¸è¢«ç”¨äºåšä¸€äº›â€œæ”¶å°¾å·¥ä½œâ€æˆ–â€œæ¸…ç†æ“ä½œâ€

å¸¸ç”¨äº å…³é—­æ•°æ®åº“è¿æ¥ï¼Œæ¸…ç†çº¿ç¨‹æˆ–èµ„æºï¼Œè®°å½•å¼‚å¸¸æ—¥å¿—ï¼Œæ‰“å°è¯·æ±‚ç»“æŸæ ‡è®°ï¼Œæ¸…é™¤å…¨å±€å˜é‡ï¼ˆå¦‚ g å¯¹è±¡ä¸­çš„æ•°æ®ï¼‰ç­‰è¡Œä¸º

åœ¨ä¸Šé¢çš„`before_request`å†™äº†ä¸¤ç§æ–¹æ¡ˆï¼Œafter_requesté’©å­ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ç¤ºä¾‹ä»£ç åªå±•ç¤ºä¸€ç§æ¨èçš„

```python
"""
æ¯ä¸ªè¯·æ±‚å¤„ç†å®Œåæ— è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªæ³¨å†Œçš„é’©å­ä»£ç 
"""

from flask import Flask, request

app = Flask(__name__)


# æ³¨å†Œé’©å­
@app.teardown_request
def teardown_request_event(exception):  # éœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœæˆåŠŸæ˜¯Noneï¼Œå¦åˆ™æœ‰é”™è¯¯ä¿¡æ¯
    print(f'é”™è¯¯æ—¥å¿—è®°å½•ï¼š{exception}')

    # å¦‚æœæ˜¯ä½ çš„é™æ€æ–‡ä»¶è®¿é—®å°±ä¸ç»§ç»­æ‰§è¡Œä¸‹é¢ä»£ç äº†
    if request.path.startswith('/static/'):  # æ ¹æ®ä½ çš„æƒ…å†µæ˜¯å¦éœ€è¦å¤„ç†
        return

    print("æ¯ä¸ªè¯·æ±‚åå“åº”å‰éƒ½æ‰§è¡Œäº†æ”¹ä»£ç ")


@app.route('/')
def index():
    print("index")
    return "index"


@app.route('/page')
def page():
    print("page")
    return "page"


if __name__ == '__main__':
    app.run()
```

# ä¸Šä¸‹æ–‡å˜é‡

ä¸Šä¸‹æ–‡å˜é‡éƒ½éœ€è¦åœ¨è§†å›¾/è·¯ç”±ä¸Šä¸‹æ–‡çš„ç©ºé—´é‡Œé¢ä½¿ç”¨ï¼Œå¦åˆ™æŠ¥é”™

## current_app

current_app æ˜¯ Flask æä¾›çš„ä¸€ä¸ªä¸Šä¸‹æ–‡å˜é‡ï¼Œç”¨æ¥åœ¨ä»»æ„ä½ç½®å®‰å…¨åœ°è®¿é—®å½“å‰æ­£åœ¨è¿è¡Œçš„ Flask åº”ç”¨å¯¹è±¡ï¼ˆFlask å®ä¾‹ï¼‰ï¼Œå³ä½¿ä½ ä¸åœ¨ä¸€ä¸ªç›´æ¥èƒ½è®¿é—® app çš„ä½œç”¨åŸŸå†…ã€‚

æ³¨æ„ï¼šå®ƒå¿…é¡»åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨

current_app æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡å˜é‡ï¼Œå¦‚æœä½ åœ¨æ²¡æœ‰è¯·æ±‚æˆ–æ²¡æœ‰æ¨é€ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œä¼šæŠ¥é”™

åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡,ç”¨äºå­˜å‚¨flaskåº”ç”¨å®ä¾‹å¯¹è±¡ä¸­çš„å˜é‡ï¼Œå¯ä»¥é€šè¿‡current_app.nameæ‰“å°å½“å‰appçš„åç§°ï¼Œä¹Ÿå¯ä»¥åœ¨current_appä¸­å­˜å‚¨ä¸€äº›å˜é‡ï¼Œä¾‹å¦‚ï¼š

- åº”ç”¨çš„å¯åŠ¨è„šæœ¬æ˜¯å“ªä¸ªæ–‡ä»¶ï¼Œå¯åŠ¨æ—¶æŒ‡å®šäº†å“ªäº›å‚æ•°
- åŠ è½½äº†å“ªäº›é…ç½®æ–‡ä»¶ï¼Œå¯¼å…¥äº†å“ªäº›é…ç½®
- è¿æ¥äº†å“ªä¸ªæ•°æ®åº“
- æœ‰å“ªäº›å¯ä»¥è°ƒç”¨çš„å·¥å…·ç±»ã€å¸¸é‡
- å½“å‰flaskåº”ç”¨åœ¨å“ªä¸ªæœºå™¨ä¸Šï¼Œå“ªä¸ªIPä¸Šè¿è¡Œï¼Œå†…å­˜å¤šå¤§

ç®€å•ç†è§£å°±æ˜¯å…¬å…±å®¹å™¨

```python
from flask import Flask, current_app

app = Flask(__name__)


@app.route('/')
def index():
    """
    åº”ç”¨ä¸Šä¸‹æ–‡æä¾›äº†ä¸€ä¸ªå®¹å™¨ï¼Œä½¿ä½ èƒ½å¤Ÿåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«æ•°æ®å’Œå¯¹è±¡ã€‚
    åº”ç”¨ä¸Šä¸‹æ–‡æä¾›ç»™æˆ‘ä»¬ä½¿ç”¨çš„å˜é‡ï¼Œä¹Ÿæ˜¯åªèƒ½åœ¨è§†å›¾æˆ–è¢«è¯•å›¾è°ƒç”¨çš„åœ°æ–¹è¿›è¡Œä½¿ç”¨
    åº”ç”¨ä¸Šä¸‹æ–‡æ‰€æœ‰çš„æ•°æ®æ¥æºéƒ½æ˜¯app
    """
    print(current_app)  # åº”ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å¯¹è±¡
    print(current_app.config)  # è·å–å½“å‰é¡¹ç›®çš„æ‰€æœ‰é…ç½®ä¿¡æ¯
    print(current_app.url_map)  # è·å–å½“å‰é¡¹ç›®çš„æ‰€æœ‰è·¯ç”±ä¿¡æ¯,<Rule '/static/<filename>è·¯ç”±æ˜¯flaskå†…éƒ¨å®šä¹‰çš„é™æ€æ–‡ä»¶è·¯ç”±

    return ' '


if __name__ == '__main__':
    app.run()
```

## gå˜é‡

g ä½œä¸º flask ç¨‹åºå…¨å±€çš„ä¸€ä¸ªä¸´æ—¶å˜é‡,å……å½“ç€ä¸­é—´åª’ä»‹çš„ä½œç”¨,æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒä¼ é€’ä¸€äº›æ•°æ®ï¼Œ
g ä¿å­˜çš„æ˜¯å½“å‰è¯·æ±‚çš„å…¨å±€å˜é‡ï¼Œä¸åŒçš„è¯·æ±‚ä¼šæœ‰ä¸åŒçš„å…¨å±€å˜é‡ï¼Œé€šè¿‡ä¸åŒçš„thread idåŒºåˆ«

æ³¨æ„ï¼šå®¢æˆ·ç«¯ä¸åŒçš„è¯·æ±‚ï¼Œä¼šæœ‰ä¸åŒçš„å…¨å±€å˜é‡gï¼Œæˆ–è€…è¯´ï¼Œæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½æ‹¥æœ‰å±äºè‡ªå·±çš„gå˜é‡ï¼ˆä¸ä¼šå†²çªï¼‰ã€‚

å…¨å±€æ•°æ®å­˜å‚¨å¯¹è±¡ï¼Œç”¨äºä¿å­˜æœåŠ¡ç«¯å­˜å‚¨çš„å…¨å±€å˜é‡æ•°æ®\[å¯ä»¥ç†è§£ä¸ºç”¨æˆ·çº§åˆ«çš„å…¨å±€å˜é‡å­˜å‚¨å¯¹è±¡]

```python
"""
å¯ä»¥è¢«å…¨å±€æ”¹å˜çš„ä¸Šä¸‹æ–‡å˜é‡g
ä¸æ”¯æŒg['info']çš„æ–¹å¼æ“ä½œï¼Œåªæœ‰ç‚¹çš„æ–¹å¼
"""
from flask import Flask, g

app = Flask(__name__)


def test():
    g.user = 'BinaryFool'


@app.route('/')
def index():
    g.user = 'å°æ˜'
    print(g.user)

    # æ”¹å˜å€¼
    test()
    print(g.user)

    return ' '


if __name__ == '__main__':
    app.run()
```

## åˆ›å»ºä¸€ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ç¯å¢ƒè°ƒç”¨

ä½¿ç”¨withåˆ›å»ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå°±ä¸éœ€è¦åœ¨è§†å›¾ä¸­å•ç‹¬ä½¿ç”¨äº†

å¦‚æœè°ƒè¯•ä½œç”¨è¾“å‡ºçš„å†…å®¹ä¼šåœ¨æ§åˆ¶å°æ—¥å¿—é¡¶ç«¯

```python
from flask import Flask, g, current_app

app = Flask(__name__)

with app.app_context():  # ä½¿ç”¨withåˆ›å»ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå°±ä¸éœ€è¦åœ¨è§†å›¾ä¸­å•ç‹¬ä½¿ç”¨äº†
    print(current_app)
    print(g)
```

# url_foråŠ¨æ€ç”Ÿæˆurl

ä½œç”¨æ˜¯æ ¹æ®è§†å›¾å‡½æ•°çš„åå­—ç”Ÿæˆå¯¹åº”çš„ URL åœ°å€ï¼Œä»è€Œé¿å…ä½ åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  URL

å‡è®¾ä½ çš„è§†å›¾å‡½æ•°æˆ–è·¯ç”±è·¯å¾„å°†æ¥æ”¹å˜äº†ï¼Œå¦‚æœä½ åœ¨ä»£ç ä¸­å†™æ­»äº† URLï¼ˆæ¯”å¦‚ /user/profileï¼‰ï¼Œé‚£ä½ å°±å¾—æ‰‹åŠ¨ä¿®æ”¹æ‰€æœ‰ç”¨åˆ°è¿™ä¸ªè·¯å¾„çš„åœ°æ–¹ï¼Œéå¸¸éº»çƒ¦ã€‚
è€Œä½¿ç”¨ url_for å¯ä»¥è‡ªåŠ¨æ ¹æ®å‡½æ•°åç”Ÿæˆ URLï¼Œä¿®æ”¹è·¯ç”±æ—¶åªéœ€è¦æ”¹ä¸€å¤„å³å¯ï¼Œç»´æŠ¤èµ·æ¥æ›´æ–¹ä¾¿ã€‚

```python
from flask import Flask, url_for

app = Flask(__name__)


@app.route('/page/<name>')
def page_fun(name):
    return f"{name}çš„pageé¡µé¢"


@app.route('/')
def index():
    name = 'ç®¡ç†å‘˜'

    # ä¼šè‡ªåŠ¨å¤„ç†è¿”å›è·¯ç”±è·¯å¾„ï¼Œå‚æ•°ä¸€ä¼ å…¥è§†å›¾å³å¯ï¼Œå…¶ä»–çš„å‚æ•°æ˜¯ä¼ å…¥è·¯ç”±éœ€è¦æ¥æ”¶çš„æ•°æ®
    url = url_for('page_fun', name=name)
    print(url)

    return url


if __name__ == '__main__':
    app.run()
```

# Jinjia2æ¨¡æ¿æ¸²æŸ“

Jinja2 æ˜¯ä¸€ä¸ªåŸºäº Python çš„æ¨¡æ¿å¼•æ“ï¼Œå®ƒè¢«å¹¿æ³›ç”¨äº Web å¼€å‘ä¸­ï¼ŒFlaskå†…ç½®çš„æ¨¡æ¿è¯­è¨€Jinja2ï¼Œå®ƒçš„è®¾è®¡æ€æƒ³æ¥æºäº Django çš„æ¨¡æ¿å¼•æ“DTP(DjangoTemplates)ï¼Œå¹¶æ‰©å±•äº†å…¶è¯­æ³•å’Œä¸€ç³»åˆ—å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½¿å¾—åœ¨ç”ŸæˆåŠ¨æ€å†…å®¹æ—¶å˜å¾—éå¸¸æ–¹ä¾¿ã€‚

- Flaskæä¾›çš„ **render_template** å‡½æ•°å°è£…äº†è¯¥æ¨¡æ¿å¼•æ“Jinja2
- **render_template** å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¨¡æ¿çš„æ–‡ä»¶åï¼Œåé¢çš„å‚æ•°éƒ½æ˜¯é”®å€¼å¯¹ï¼Œè¡¨ç¤ºæ¨¡æ¿ä¸­å˜é‡å¯¹åº”çš„æ•°æ®å€¼ã€‚

ç®€è€Œè¨€ä¹‹ï¼šæ“ä½œhtmlæ¨¡æ¿æ–‡ä»¶å®ç°æ•°æ®çš„ä¼ é€’ï¼Œè¿˜å¯ä»¥æ“ä½œpythonä¼ é€’è¿‡æ¥çš„å˜é‡/å¯¹è±¡ç­‰

## æ¨¡æ¿åŸºæœ¬ä½¿ç”¨

éœ€è¦æ‰‹åŠ¨åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`templates`æ¨¡æ¿æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ¨¡æ¿çš„ï¼Œ
ç¼–è¾‘å™¨æ˜¯pycharmçš„éœ€è¦æŠŠæ–‡ä»¶å¤¹å³é”®æ ‡è®°ä¸ºæ¨¡æ¿æ–‡ä»¶å¹¶ä¸”é€‰æ‹©æ¨¡æ¿è¯­è¨€ä¸ºJinjia2ï¼Œè¿™æ ·pycharmè¯†åˆ«çš„æ—¶å€™æ‰ä¸ä¼šè­¦å‘Šï¼Œè€Œä¸”è¿˜æé«˜äº†ç¼–å†™ä»£ç çš„æ•ˆç‡

ä½¿ç”¨å‚æ•°çš„ä¼ é€’å¯ä»¥æŠŠæ•°æ®å˜é‡ä¼ é€’åˆ°HTMLæ¨¡æ¿ï¼Œæ¨¡æ¿ä½¿ç”¨`{{}}`å ä½å†™å…¥å˜é‡åç§°æ¥æ¥æ”¶å˜é‡å€¼å³å¯

pythonä¼ é€’è¿‡æ¥åˆ°HTMLæ¨¡æ¿çš„æ•°æ®å¯ä»¥åƒæ“ä½œpythonä¸€æ ·æ“ä½œä»–ä»¬ï¼ˆå–å€¼ï¼Œç­‰ï¼‰

```html
{#
{{}} -> æ˜¯å ä½ç¬¦
{#  #\} -> æ˜¯æ¨¡æ¿æ³¨é‡Šè¯­æ³•ï¼Œ\å¯ä»¥åˆ é™¤ï¼Œç”¨äºè½¬ä¹‰çš„
#}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
</head>
<body>

<h1>{{ content }}</h1>

<h2>æ•°æ®ç±»å‹</h2>
<p>{{ list[-1] }}</p>
<p>{{ dict }}</p>
<p>å–å€¼æ•°æ®ç±»å‹: {{ dict['name'] }}</p>
<p>å–å€¼æ•°æ®ç±»å‹: {{ dict.name }}</p> {# åœ¨HTMLé‡Œé¢è¿˜å¯ä»¥è¿™æ ·ä½¿ç”¨æ¥å–å€¼ï¼Œpythonä¸è¡Œ #}
<p>{{ set }}</p>
<p>{{ bool }}</p>

</body>
</html>
```

```python
from flask import Flask, render_template

"""
template_folder:æŒ‡å®šæ¨¡æ¿å­˜æ”¾çš„è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸ºtemplatesè·¯å¾„(å¯ä»¥ä¸å†™)ï¼Œå¯ä»¥é€‰æ‹©è‡ªå®šä¹‰çš„ï¼Œä½†æ˜¯æ¨èä½¿ç”¨é»˜è®¤
æ–‡ä»¶å¤¹éœ€è¦æ‰‹åŠ¨åˆ›å»º(é¡¹ç›®æ ¹ç›®å½•)ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯HTMLæ¨¡æ¿æ–‡ä»¶

static_folder:æŒ‡å®šé™æ€æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤å€¼æ˜¯static(å¯ä»¥ä¸å†™)ï¼Œå¯ä»¥é€‰æ‹©è‡ªå®šä¹‰çš„ï¼Œä½†æ˜¯æ¨èä½¿ç”¨é»˜è®¤
é‡Œé¢å­˜æ”¾cssï¼Œjsï¼Œimgï¼Œâ€¦â€¦ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶å¤¹(é¡¹ç›®æ ¹ç›®å½•)
"""
app = Flask(__name__, template_folder='templates', static_folder='static')


@app.route('/')
def index():
    title = 'index'
    content = 'è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªflaskæ¨¡æ¿ç¨‹åº'
    context = {
        "title": title,
        "content": content,
        'list': [1, 2, 'a', 'v'],
        'dict': {'name': 'å°æ˜', 'age': 19},
        'set': {1, 2, 34, 4},
        'bool': True
    }

    """
    è¿™ä¸‰ç§å†™æ³•éƒ½å¯ä»¥æŠŠæ•°æ®ä¼ é€’åˆ°HTML
    **locals(): æœ¬åœ°ä¸Šä¸‹æ–‡ï¼Œä¼šæŠŠå½“å‰å‡½æ•°ä¸­çš„æ‰€æœ‰å±€éƒ¨å˜é‡éƒ½ä¼ è¿›æ¨¡æ¿ï¼ŒåŒ…æ‹¬ä½ æ²¡æ‰“ç®—ä¼ çš„ä¸´æ—¶å˜é‡ã€è°ƒè¯•å˜é‡ã€æ•°æ®åº“è¿æ¥å¯¹è±¡ç­‰ï¼Œçœ‹æ¨¡æ¿éœ€è¦å“ªä¸ªæŒ‘å“ªä¸ª
    æ˜¾ç¤ºä¼ é€’ï¼šæ˜ç¡®åªä¼ äº†éœ€è¦çš„å˜é‡ï¼Œæ§åˆ¶äº†å˜é‡çš„æ•°é‡å’Œå‘½åï¼Œå®‰å…¨æ€§é«˜ï¼Œä»£ç å¯è¯»æ€§å¼ºã€‚
    **contextï¼šé™å®šä¸Šä¸‹æ–‡ï¼Œåªæš´éœ²æŒ‡å®šçš„é”®å€¼å¯¹ç»™æ¨¡æ¿æ–‡ä»¶ï¼Œè¿™æ ·ä»£ç åˆä¸å†—é•¿è€Œä¸”ç¾è§‚ï¼ˆæ¨èçš„åšæ³•ğŸ‘ï¼‰
    
    æœ€ç»ˆè¾“å‡ºçš„ HTML æ˜¯å­—ç¬¦ä¸²ç»„æˆçš„ï¼Œæ‰€ä»¥å¯ä»¥è¿”å›ä»»ä½•æ•°æ®ç±»å‹ã€‚å¦‚æœéœ€è¦å¤„ç†å¯ä»¥è¿›ä¸€æ­¥åœ¨HTMLæ¨¡æ¿ä¸­æ“ä½œä»–ä»¬ï¼Œè¿™æ—¶å€™ä»–ä»¬è¿˜ä¸æ˜¯å®Œå…¨çš„å­—ç¬¦ä¸²ï¼Œ
    è¿˜æ˜¯pythonçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥åƒæ“ä½œpythonä¸€æ ·æ“ä½œä»–ä»¬ï¼ˆå–å€¼ï¼Œç­‰ï¼‰
    """
    # return render_template('index.html', title=title, content=content)
    # return render_template('index.html', **locals())
    return render_template('index.html', **context)


if __name__ == '__main__':
    app.run()
```

## æ¨¡æ¿ä¸­è‡ªåŠ¨å¯ç”¨çš„å˜é‡/å‡½æ•°

| ç±»å‹   | åç§°                                    | æ˜¯å¦è‡ªåŠ¨æ³¨å…¥ |
|------|---------------------------------------|--------|
| è¯·æ±‚ä¿¡æ¯ | `request`, `session`, `g`             | âœ… æ˜¯    |
| è·¯ç”±å‡½æ•° | `url_for()`, `get_flashed_messages()` | âœ… æ˜¯    |
| ç™»å½•ä¿¡æ¯ | `current_user`ï¼ˆé…åˆ Flask-Loginï¼‰        | âœ… æ˜¯    |
| å…¶ä»–å…¨å±€ | `config`ï¼ˆéœ€è¦æ‰‹åŠ¨æ³¨å…¥ï¼‰                      | âŒ å¦    |

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

{# å¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰ä¼ å…¥/å¯¼å…¥å…¨å±€å˜é‡ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥æ“æ§ï¼Œå› ä¸ºflaskå®˜æ–¹æ³¨å…¥äº† #}

{{ g.__dict__ }}
{{ session.__dict__ }}

</body>
</html>
```

```python
"""å¹¶æ²¡æœ‰å¯¼å…¥å’Œä½¿ç”¨session,gï¼Œä½†æ˜¯å°±æ˜¯å¯ä»¥åœ¨HTMLæ¨¡æ¿ä½¿ç”¨ï¼Œå› ä¸ºå®˜æ–¹å·²ç»ä¸ºä»–ä»¬æ³¨å…¥äº†"""
from flask import Flask, render_template

app = Flask(__name__)


@app.route('/')
def index():
    return render_template('index.html')


if __name__ == '__main__':
    app.run()
```

## æ¨¡æ¿ä¸­çš„æµç¨‹æ§åˆ¶è¯­å¥

åœ¨HTMLæ¨¡æ¿æ‰§è¡Œæµç¨‹æ§åˆ¶è¯­å¥(pythonè¯­æ³•)éœ€è¦æ˜¯`{% %}`æ¥åŒ…è£¹è¯­æ³•,ä½†æ˜¯ä¸€å¥å°±ä¸€ä¸ªè¿™ä¸ªè¯­å¥æ ‡è¯†ç¬¦ï¼Œä½†æ˜¯éœ€è¦æœ‰ç»“æŸçš„ä»£ç å—({% endif %}ç­‰)

### ifåˆ¤æ–­

å‚æ•°ä»pythonåç«¯ä¼ å…¥äº†ï¼Œè¿™é‡Œä¸å†å†—é•¿çš„å†™python

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

ä¼ é€’çš„å€¼ï¼š{{ value }}

<div>
    {# ifåˆ¤æ–­é€»è¾‘ï¼Œé€»è¾‘ä¸æˆç«‹çš„å°±ä¸ä¼šæ¸²æŸ“æ ‡ç­¾ï¼Œæˆç«‹åˆ™ä¼šæ¸²æŸ“æ ‡ç­¾ #}

    {% if value < 60 %}
    <p>ä¸åŠæ ¼</p>
    {% elif value < 80 %}
    <p>åŠæ ¼</p>
    {% elif value < 90 %}
    <p>ä¼˜ç§€</p>
    {% else %}
    <p>å…¶ä»–åˆ†æ•°</p>
    {% endif %}
</div>

</body>
</html>
```

### forå¾ªç¯

å‚æ•°æ˜¯åˆ—è¡¨é‡Œé¢åµŒå¥—å­—å…¸ï¼ˆè¿™æ˜¯ä¾‹å­ï¼Œä½ å¯ä»¥ä¼ å…¥ä»»ä½•åˆ—è¡¨é‡Œé¢åµŒå¥—çš„ç±»å‹ï¼‰ï¼š\[{'name': 'å°æ˜'},{'name': 'å°ç™½'}]

for å¾ªç¯å†…éƒ¨è‡ªåŠ¨æä¾›ä¸€ä¸ªå« loop çš„ç‰¹æ®Šå˜é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¾ªç¯åŠ©æ‰‹å¯¹è±¡ï¼ŒåŒ…å«äº†å½“å‰å¾ªç¯çš„å„ç§çŠ¶æ€ä¿¡æ¯ï¼Œç›¸å½“äºpythonä¼ é€’è¿‡æ¥çš„å­—å…¸ï¼Œç›´æ¥ç”¨å–å³å¯

| å±æ€§å              | ç±»å‹   | è¯´æ˜                                |
|------------------|------|-----------------------------------|
| `loop.index`     | int  | å½“å‰æ˜¯ç¬¬å‡ æ¬¡å¾ªç¯ï¼ˆä» 1 å¼€å§‹ï¼‰                  |
| `loop.index0`    | int  | å½“å‰æ˜¯ç¬¬å‡ æ¬¡å¾ªç¯ï¼ˆä» 0 å¼€å§‹ï¼‰                  |
| `loop.revindex`  | int  | è·ç¦»ç»“æŸè¿˜æœ‰å‡ æ¬¡ï¼ˆä» 1 å¼€å§‹ï¼‰                  |
| `loop.revindex0` | int  | è·ç¦»ç»“æŸè¿˜æœ‰å‡ æ¬¡ï¼ˆä» 0 å¼€å§‹ï¼‰                  |
| `loop.first`     | bool | æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡å¾ªç¯                          |
| `loop.last`      | bool | æ˜¯å¦æ˜¯æœ€åä¸€æ¬¡å¾ªç¯                         |
| `loop.length`    | int  | è¦å¾ªç¯çš„æ€»æ¬¡æ•°                           |
| `loop.cycle()`   | å‡½æ•°   | åœ¨å¤šä¸ªå€¼ä¹‹é—´äº¤æ›¿è¾“å‡ºï¼ˆå…ˆä½¿ç”¨ç¬¬ä¸€ä¸ªå€¼ä¸‹ä¸€æ¬¡ä½¿ç”¨ç¬¬äºŒä¸ªå€¼ï¼Œä¾æ¬¡äº¤æ›¿ï¼‰ |
| `loop.depth`     | int  | å½“å‰åµŒå¥—çš„æ·±åº¦ï¼ˆä» 1 å¼€å§‹ï¼‰                   |
| `loop.depth0`    | int  | å½“å‰åµŒå¥—çš„æ·±åº¦ï¼ˆä» 0 å¼€å§‹ï¼‰                   |
| `loop.parent`    | obj  | å¤–å±‚å¾ªç¯çš„ `loop`ï¼ˆåµŒå¥—å¾ªç¯æ—¶ç”¨ï¼‰              |

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

ä¼ é€’çš„å€¼ï¼š{{ values }}

<div>
    {# forå¾ªç¯ #}

    {% for value in values %}
    <p {{ loop.cycle('data-attr="ss"', 'data-attr="aa') }}> {# ä¼šäº¤æ›¿ç»™å±æ€§ï¼Œloop.cycle()æ–¹æ³•æ˜¯äº¤æ›¿æ‰§è¡Œçš„ #}
    <span>{{ loop.index }}</span> {# è·å–ç´¢å¼•ï¼Œ1å¼€å§‹ #}
    <span>{{ value['name'] }}</span> {# è¿™æ˜¯å–é‡Œé¢å­—å…¸çš„å½¢å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨.çš„å½¢å¼ #}
    {{ loop }}
    </p>
    {% endfor %}

</div>

</body>
</html>
```

## è¿‡æ»¤å™¨

éœ€è¦ä½¿ç”¨æ•´å—è¿›è¡Œè¿‡æ»¤å¯ä»¥ä½¿ç”¨`filter`è¯­å¥ï¼š`{% filter upper %} {% endfilter %}`,è¯­å¥æ„æ€ä¸ºå…¨éƒ¨å¤§å†™ --> åˆ—è¡¨è¿‡æ»¤å™¨æåˆ°è¿‡

è¿‡æ»¤å™¨è¿­ç”¨ï¼šä¼šç­‰å‰é¢çš„è¿‡æ»¤å™¨è¿è¡Œå®Œæˆåå†è¿›è¡ŒäºŒæ¬¡è¿‡æ»¤`{{ 'HELLO' | lower | upper}}`,å°å†™ååˆå¤§å†™(ä½†æ˜¯è¿™æ˜¯å¾’åŠ³ï¼Œç”¨æ¥ä¸¾ä¾‹)

### å­—ç¬¦ä¸²è¿‡æ»¤å™¨

flaské»˜è®¤å¯¹ä¼ å…¥çš„æ¨¡æ¿æ•°æ®å­—ç¬¦ä¸ä¼šè½¬ä¹‰ï¼Œä¸¾ä¾‹ï¼šä¼ å…¥æ ‡ç­¾ï¼Œå±•ç¤ºçš„æ˜¯å­—ç¬¦ä¸²æ ‡ç­¾ï¼Œä¸ä¼šè¿›è¡Œè§£æã€‚ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢æ³¨å…¥æ”»å‡»ï¼Œæ¯”å¦‚å†™äº†ä¸€ä¸ªscrapyæ ‡ç­¾è¿›è¡Œæ”»å‡»ã€‚
éå¿…è¦ä¸å»ºè®®ä½¿ç”¨è½¬ä¹‰

| è¿‡æ»¤å™¨          | æè¿°                                            | ä»£ç                                                                                                                                      |
|--------------|-----------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| **safe**     | å®ä½“å­—ç¬¦çš„è½¬ä¹‰(é»˜è®¤ä¸è½¬ä¹‰ï¼Œå…¨éƒ½æ˜¯å­—ç¬¦ä¸²çš„å½¢å¼ï¼ŒåŒ…æ‹¬æ ‡ç­¾ï¼Œä½¿ç”¨safeå°±å¯ä»¥è½¬ç§»)     | {{ '\<p>hello\</p>' \| safe}}                                                                                                          |
| lower        | æŠŠå­—æ¯è½¬æˆå°å†™                                       | {{ 'HELLO' \| lower }}                                                                                                                 |
| upper        | æŠŠå­—æ¯è½¬æˆå¤§å†™                                       | {{ 'hello' \| upper }}`                                                                                                                |
| **reverse**  | åºåˆ—ç±»å‹çš„æ•°æ®åè½¬ï¼Œæ”¯æŒå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å…ƒç¥–                         | {{ 'olleh' \| reverse }}                                                                                                               |
| format       | æ ¼å¼åŒ–è¾“å‡º                                         | {{ '%s = %d' \| format('name',17) }}`<br>`{{ '%s = %d' % ('name', 17) }}                                                               |
| striptags    | æ¸²æŸ“ä¹‹å‰æŠŠå€¼ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾éƒ½åˆ æ‰                           | {{ '\<script>alert("hello")\</script>' \| striptags }}`<br>å¦‚å†…å®¹ä¸­å­˜åœ¨å¤§å°äºå·çš„æƒ…å†µï¼Œåˆ™ä¸è¦ä½¿ç”¨è¿™ä¸ªè¿‡æ»¤å™¨ï¼Œå®¹æ˜“è¯¯åˆ å†…å®¹ã€‚{{ "å¦‚æœx<yï¼Œz>xï¼Œé‚£ä¹ˆxå’Œzä¹‹é—´æ˜¯å¦ç›¸ç­‰ï¼Ÿ" \| striptags }} |
| **truncate** | å­—ç¬¦ä¸²æˆªæ–­<br>truncate(æˆªå–é•¿åº¦, æ˜¯å¦å¼ºåˆ¶æˆªå–False, çœç•¥ç¬¦å·...) | {{ 'hello every one' \| truncate(9)}}                                                                                                  |

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

<p>
    {#  å­—æ¯è½¬å°å†™  #}
    {{ 'HELLO' | lower }}
</p>
<p>
    {#  å­—æ¯è½¬å¤§å†™  #}
    {{ 'hello' |  upper }}
</p>
<p>
    {#  åºåˆ—æ•°æ®åè½¬  #}
    {{ 'hello' |  reverse }}
</p>

<p>
    {#  å»é™¤å¼€å¤´ç»“å°¾çš„æ ‡ç­¾  #}
    {{ '<h1>alert("hello")</h1>' |  striptags }}
    {#  æœ‰å¤§äºå°äºå·ä¼šå¯¼è‡´è¯¯åˆ   #}
    {{ "å¦‚æœx<yï¼Œz>xï¼Œé‚£ä¹ˆxå’Œzä¹‹é—´æ˜¯å¦ç›¸ç­‰ï¼Ÿ" | striptags }}
</p>

<p>
    {#  å­—ç¬¦ä¸²æˆªæ–­ï¼Œä¼ å‚æŒ‰å­—ç¬¦ç®—ï¼ŒæŒ‰è¯ä¸ºä¸ªä½“ï¼Œèˆå¼ƒå¤šä½™çš„è¯æ±‡  #}

    {{ 'hello every one'  | truncate(7) }} <br> {#  æˆªå–7ä½ hello e, åä¸‰ä½è½¬... å°±æ˜¯hell...  #}

    {{ 'hello every one'  | truncate(9, killwords=True) }} <br>
    {{ "foo bar baz qux www"| truncate(11) }} <br>
    {{ "foo bar baz qux www aaa xxx xxx"|truncate(19) }} <br>
</p>


</body>
</html>
```

### åˆ—è¡¨è¿‡æ»¤å™¨

| è¿‡æ»¤å™¨    | æè¿°               | ä»£ç                              |
|--------|------------------|--------------------------------|
| first  | å–åºåˆ—ç±»å‹å˜é‡çš„ç¬¬ä¸€ä¸ªå…ƒç´     | {{ \[1,2,3,4,5,6] \| first }}  |
| last   | å–åºåˆ—ç±»å‹å˜é‡çš„æœ€åä¸€ä¸ªå…ƒç´    | {{ \[1,2,3,4,5,6] \| last }}   |
| length | è·å–åºåˆ—ç±»å‹å˜é‡çš„é•¿åº¦      | {{ \[1,2,3,4,5,6] \| length }} |
| count  | è·å–åºåˆ—ç±»å‹å˜é‡çš„é•¿åº¦      | {{ \[1,2,3,4,5,6] \| count }}  |
| sum    | åˆ—è¡¨æ±‚å’Œï¼Œæˆå‘˜åªèƒ½æ˜¯æ•°å€¼ç±»å‹ï¼ï¼ | {{ \[1,2,3,4,5,6] \| sum }}    |
| sort   | åˆ—è¡¨æ’åº             | {{ \[6,2,3,1,5,4] \| sort }}   |

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

<p>{{ [1,2,3,4,5,6] | first }}</p>
<p>{{ [1,2,3,4,5,6] | last }}</p>
<p>{{ [1,2,3,4,5,6] | length }}</p>
<p>{{ [1,2,3,4,5,6] | count }}</p>
<p>{{ [1,2,3,4,5,6] | sum }}</p>
<p>{{ [1,2,3,4,5,6] | sort }}</p>
<p>{{ [1,2,3,4,5,6] | sort(reverse=True) }}</p>

{#  è¯­å¥å—è¿‡æ»¤ï¼Œå¯¹è¿™é‡Œé¢çš„æ•´å—å ä½ç¬¦çš„å€¼è¿‡æ»¤  #}
{% filter upper %}
    <p>abc</p>
    <p>{{ ["a","c"] }}</p>
    <p>{{ ["a","c"] }}</p>
    <p>{{ ["a","c"] }}</p>
    <p>{{ ["a","c"] }}</p>
{% endfilter %}


</body>
</html>
```

### è‡ªå®šä¹‰è¿‡æ»¤å™¨

#### ç¼–å†™è¿‡æ»¤å™¨ä»£ç 

å»ºè®®ä½¿ç”¨å•ç‹¬çš„æ–‡ä»¶æ¥,æ¯”å¦‚`utils/filters.py`æ¥ç®¡ç†

```python
"""
è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œå‚æ•°äºŒå¯é€‰ï¼Œä½†æ˜¯å‚æ•°ä¸€æ˜¯å¿…é¡»çš„ï¼Œä¸ç„¶ä½ æ€ä¹ˆå¤„ç†ä¼ å…¥çš„æ•°æ®
"""


def add_str(data, string):
    """
    ç”¨äºæ·»åŠ å­—ç¬¦ä¸²çš„è¿‡æ»¤å™¨
    :param data: æ•°æ®
    :param string: æ·»åŠ çš„å­—ç¬¦
    :return: ç»“æœ
    """
    return f"{data}{string}"


"""è¿‡æ»¤å™¨å­—å…¸ï¼Œè¿‡æ»¤å™¨åç§°å¯ä»¥è‡ªè¡Œå®šä¹‰"""
FILTERS = {
    'add_str_filter': add_str
}
```

#### æ³¨å†Œè¿‡æ»¤å™¨

```python
from flask import Flask
from utils.filters import FILTERS  # è·¯å¾„è‡ªå®šä¹‰

app = Flask(__name__)

for key, obj in FILTERS.items():
    app.add_template_filter(obj, key)  # æ³¨æ„ï¼šæ˜¯åçš„ä¼ é€’æ•°æ®
```

#### é€šè¿‡è£…é¥°å™¨çš„æ–¹æ³•ç¼–å†™å’Œæ³¨å†Œè¿‡æ»¤å™¨(ä¸æ¨è)

```python
from flask import Flask

app = Flask(__name__)


@app.template_filter('add_str_filter')  # ä¼ å…¥è£…é¥°å™¨è‡ªå®šä¹‰åç§°ï¼Œä¸‹é¢çš„å°±æ˜¯è£…é¥°å™¨æ‰§è¡Œçš„å…·ä½“ä»£ç 
def add_str(data, string):
    """
    ç”¨äºæ·»åŠ å­—ç¬¦ä¸²çš„è¿‡æ»¤å™¨
    :param data: æ•°æ®
    :param string: æ·»åŠ çš„å­—ç¬¦
    :return: ç»“æœ
    """
    return f"{data}{'11'}"
```

#### ä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨

æ™®é€šçš„å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå°±å¦‚ä½•ä½¿ç”¨ï¼Œå¦‚æœä¸éœ€è¦ä¼ é€’å‚æ•°å¯ä»¥ä¸æ‰“æ‹¬å·ï¼Œä½†æ˜¯å¯ä»¥æ‰“æ‹¬å·

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

{# è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„ä½¿ç”¨ #}
<p>{{ 'info' | add_str_filter('å­—ç¬¦') }}</p>


</body>
</html>
```

